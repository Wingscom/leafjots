# Plan 01-01: Foundation + Dashboard Shell

## Phase Info
- **Phase**: 1 of 9 (v1.0)
- **Goal**: Scaffold backend (config, DI, DB, enums, pytest) and frontend (Vite+React, Layout, sidebar nav, Dashboard home)
- **Requirements**: Foundation infrastructure for all subsequent phases

## Tasks

### Task 1: Project scaffold + config
- Create `pyproject.toml` with all dependencies (FastAPI, SQLAlchemy async, Web3, Celery, etc.)
- Create `docker-compose.yml` (PostgreSQL 16, Redis 7)
- Create `.env.example` with all required env vars
- Create `src/cryptotax/config.py` — Pydantic Settings (DB, Redis, API keys, USD/VND rate)
- Create `src/cryptotax/exceptions.py` — Custom exception hierarchy

### Task 2: Dependency injection container
- Create `src/cryptotax/container.py` — dependency-injector container
- Wire Settings, engine, session_factory providers

### Task 3: Database session + base classes
- Create `src/cryptotax/db/session.py` — async engine, session factory, Base, TimestampMixin, UUIDPrimaryKey
- Configure SQLAlchemy 2.0 async with asyncpg

### Task 4: Domain enums
- Create `src/cryptotax/domain/enums/` — 12 enum files:
  - `account.py` — AccountType (ASSET, LIABILITY, INCOME, EXPENSE)
  - `balance_type.py` — BalanceType
  - `chain.py` — Chain (ethereum, bsc, polygon, arbitrum, solana)
  - `currency.py` — Currency
  - `entry_type.py` — EntryType (SWAP, DEPOSIT, BORROW, REPAY, YIELD, GAS_FEE, etc.)
  - `status.py` — TxStatus, WalletSyncStatus
  - `exchange.py` — Exchange (binance, okx)
  - `protocol.py` — Protocol (aave, uniswap, curve, etc.)
  - `data_source.py` — DataSource
  - `parse_error.py` — ParseErrorType
  - `scan.py` — ScanProvider
  - `tax.py` — GainsMode, TradeSide, TaxExemptionReason

### Task 5: Alembic setup + initial migration
- Configure `alembic.ini` and `alembic/env.py`
- Create initial migration: entities, wallets, transactions, accounts, journal_entries, journal_splits

### Task 6: FastAPI app + CORS
- Create `src/cryptotax/api/main.py` — FastAPI app with CORS for localhost:5173
- Create `src/cryptotax/api/deps.py` — get_db dependency

### Task 7: Frontend scaffold
- Initialize Vite + React 18 + TypeScript in `web/`
- Configure Tailwind CSS + PostCSS
- Create `web/src/main.tsx` — React entry point
- Create `web/src/App.tsx` — Router setup with placeholder routes
- Create `web/src/api/client.ts` — Fetch wrapper (base URL, error handling)

### Task 8: Layout + Navigation
- Create `web/src/components/Layout.tsx` — Sidebar nav + main content outlet
- Add nav items for all planned pages (Wallets, Transactions, Parser, Journal, Accounts, Errors, Tax, Reports)
- Create `web/src/pages/Dashboard.tsx` — Empty state dashboard

### Task 9: Testing infrastructure
- Configure `pytest` with asyncio mode, test paths
- Create `tests/conftest.py` — pytest fixtures (async DB session, test client)
- Create `tests/unit/test_models.py` — smoke tests for base classes
- Create `tests/unit/test_enums.py` — enum validation tests
- Configure `ruff` for linting

## Files

| File | Action |
|------|--------|
| `pyproject.toml` | CREATE |
| `docker-compose.yml` | CREATE |
| `.env.example` | CREATE |
| `alembic.ini` | CREATE |
| `alembic/env.py` | CREATE |
| `alembic/versions/0964d9636ae2_initial_phase1_tables.py` | CREATE |
| `src/cryptotax/config.py` | CREATE |
| `src/cryptotax/container.py` | CREATE |
| `src/cryptotax/exceptions.py` | CREATE |
| `src/cryptotax/db/session.py` | CREATE |
| `src/cryptotax/domain/enums/*.py` | CREATE (12 files) |
| `src/cryptotax/api/main.py` | CREATE |
| `src/cryptotax/api/deps.py` | CREATE |
| `web/package.json` | CREATE |
| `web/vite.config.ts` | CREATE |
| `web/tailwind.config.js` | CREATE |
| `web/src/main.tsx` | CREATE |
| `web/src/App.tsx` | CREATE |
| `web/src/api/client.ts` | CREATE |
| `web/src/components/Layout.tsx` | CREATE |
| `web/src/pages/Dashboard.tsx` | CREATE |
| `tests/conftest.py` | CREATE |
| `tests/unit/test_models.py` | CREATE |
| `tests/unit/test_enums.py` | CREATE |
