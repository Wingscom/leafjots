---
phase: 12-management-dashboard-comprehensive-analytics
plan: 05
type: execute
wave: 4
depends_on:
  - 12-03
  - 12-04
files_modified:
  - web/src/pages/Dashboard.tsx
  - web/src/pages/Transactions.tsx
  - web/src/pages/Journal.tsx
  - web/src/pages/Tax.tsx
  - web/src/pages/Accounts.tsx
autonomous: true
requirements:
  - ANAL-12
  - ANAL-13

must_haves:
  truths:
    - "Transactions page has date range and wallet filter controls that update the transaction list"
    - "Journal page has date/wallet/symbol/account/protocol filters and shows VND column in splits"
    - "Tax page has symbol and gain/loss filters on realized gains list"
    - "Accounts page has wallet/symbol/protocol filters and balance-at-date picker"
    - "Dashboard shows mini KPI cards with real data"
  artifacts:
    - path: "web/src/pages/Journal.tsx"
      provides: "Journal page with comprehensive filters"
      contains: "FilterBar"
    - path: "web/src/pages/Transactions.tsx"
      provides: "Transactions page with date+wallet filters"
      contains: "DateRangePicker"
  key_links:
    - from: "web/src/pages/Journal.tsx"
      to: "web/src/components/filters/FilterBar.tsx"
      via: "imports and renders FilterBar with filter children"
      pattern: "import.*FilterBar"
    - from: "web/src/pages/Journal.tsx"
      to: "web/src/hooks/useJournal.ts"
      via: "passes filter state to hook"
      pattern: "useJournalEntries.*filters"
---

<objective>
Improve existing pages (Dashboard, Transactions, Journal, Tax, Accounts) with filter controls, additional data columns, and better data display using the shared filter components from Plan 03.

Purpose: Quick wins that improve the existing user experience. Users can now filter and drill into data on pages they already use, before the dedicated analytics pages are built.

Output: 5 improved existing pages with filter controls and enhanced data display
</objective>

<execution_context>
@C:/Users/PC/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/PC/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/12-management-dashboard-comprehensive-analytics/12-03-SUMMARY.md
@web/src/pages/Dashboard.tsx
@web/src/pages/Transactions.tsx
@web/src/pages/Journal.tsx
@web/src/pages/Tax.tsx
@web/src/pages/Accounts.tsx
@web/src/hooks/useTransactions.ts
@web/src/hooks/useJournal.ts
@web/src/hooks/useTax.ts
@web/src/hooks/useAccounts.ts
@web/src/api/transactions.ts
@web/src/api/journal.ts
@web/src/api/tax.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add filters to Transactions and Journal pages</name>
  <files>
    web/src/pages/Transactions.tsx
    web/src/pages/Journal.tsx
  </files>
  <action>
**Transactions.tsx:**
- Import FilterBar, DateRangePicker, WalletSelector, ChainSelector from `../components/filters`
- Add state: `dateFrom`, `dateTo`, `walletId`, `chain` (all string | null, default null)
- Render FilterBar above the transaction list containing DateRangePicker + WalletSelector (from wallet list hook) + ChainSelector
- Pass filter values to `useTransactions` hook (which passes to API client)
- Add reset handler to clear all filters
- Keep existing table layout but integrate Pagination component if not already present

**Journal.tsx:**
- Import FilterBar, DateRangePicker, WalletSelector, SymbolInput, EntryTypeSelector, AccountTypeSelector, ProtocolSelector from `../components/filters`
- Add state for all filter values
- Render FilterBar with all 6 filter controls
- Pass filters to `useJournalEntries` hook
- Add VND column to the journal splits display: show `value_vnd` formatted as "VND X,XXX,XXX" alongside existing USD column
- Add balance validation indicator: small green checkmark or red X per entry based on whether splits sum to zero (compute client-side from split data)
- Support URL search params for drill-down: read `?entry_type=SWAP&symbol=ETH` from URL and set as initial filter state, so analytics pages can link here with pre-set filters

For URL param drill-down, use `useSearchParams` from react-router-dom. On filter change, update URL params. On page load, read params and set initial state.
  </action>
  <verify>
Run: `cd web && npx tsc --noEmit` — no TypeScript errors.
Verify FilterBar renders on both pages.
  </verify>
  <done>Transactions page has date/wallet/chain filters. Journal page has 6 filters, VND column, balance indicator, and URL drill-down support.</done>
</task>

<task type="auto">
  <name>Task 2: Add filters to Tax, Accounts pages and enhance Dashboard</name>
  <files>
    web/src/pages/Tax.tsx
    web/src/pages/Accounts.tsx
    web/src/pages/Dashboard.tsx
  </files>
  <action>
**Tax.tsx:**
- Add filter section below the calculate form for the realized gains list: SymbolInput, two radio/toggle buttons for "Gains only" / "Losses only" / "All", holding days range (two number inputs for min/max)
- Pass filter values to `getRealizedGains` API call
- Add a "View Tax Analytics" link/button that navigates to `/tax/analytics`
- For open lots: add SymbolInput filter

**Accounts.tsx:**
- Add FilterBar with: WalletSelector, SymbolInput, ProtocolSelector, AccountTypeSelector
- Add a "Balance at date" DatePicker — when set, the balances are computed as sum of splits up to that date (pass `date_to` param to account balance API or compute client-side if data is available)
- Pass filters to accounts list API call
- In account history (splits list for a specific account), add DateRangePicker to filter splits by date range

**Dashboard.tsx:**
- Add a mini-chart section below the existing stats cards. Import `useCashFlow` and `useOverview` hooks from useAnalytics.
- Render a small (height 200) CashFlowChart showing last 6 months.
- Update the stat cards to use real KPI data from `useOverview` if available (gracefully fall back to existing data if analytics endpoint fails or returns empty).
- Add a "View Analytics" quick action button that navigates to `/analytics`.
  </action>
  <verify>
Run: `cd web && npx tsc --noEmit` — no TypeScript errors.
Verify Dashboard renders mini chart without crashing when data is empty.
  </verify>
  <done>Tax page has symbol/gain-loss/holding filters. Accounts page has wallet/symbol/protocol filters + balance-at-date. Dashboard shows mini CashFlowChart and analytics link.</done>
</task>

</tasks>

<verification>
- `cd web && npx tsc --noEmit` — zero TypeScript errors
- All 5 pages import and render filter components
- Journal page reads URL search params for drill-down
- Dashboard mini chart handles empty data gracefully
</verification>

<success_criteria>
- Users can filter transactions by date range, wallet, and chain
- Users can filter journal entries by 6 dimensions and see VND values
- Tax page gains list is filterable by symbol and gain/loss direction
- Accounts page supports balance-at-date queries
- Dashboard shows a mini cash flow chart
</success_criteria>

<output>
After completion, create `.planning/phases/12-management-dashboard-comprehensive-analytics/12-05-SUMMARY.md`
</output>
