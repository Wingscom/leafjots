---
phase: 12-management-dashboard-comprehensive-analytics
plan: 06
type: execute
wave: 5
depends_on:
  - 12-04
  - 12-05
files_modified:
  - web/src/pages/Analytics.tsx
  - web/src/pages/TaxAnalytics.tsx
  - web/src/components/AIInsight.tsx
  - web/src/App.tsx
  - web/src/components/Layout.tsx
autonomous: true
requirements:
  - ANAL-14
  - ANAL-15
  - ANAL-16

must_haves:
  truths:
    - "Navigating to /analytics shows a management dashboard with KPI cards, cash flow chart, composition donut, top symbols, activity heatmap, and more"
    - "Navigating to /tax/analytics shows tax analytics with gains chart, holding distribution, winners/losers, tax breakdown, and unrealized P&L"
    - "Sidebar navigation includes Analytics and Tax Analytics links"
    - "Clicking a chart bar or element on Analytics page navigates to Journal page with pre-set filters"
    - "AIInsight placeholder component exists with stub backend endpoint"
  artifacts:
    - path: "web/src/pages/Analytics.tsx"
      provides: "Full management analytics dashboard page"
      contains: "export default function Analytics"
    - path: "web/src/pages/TaxAnalytics.tsx"
      provides: "Tax analytics dashboard page"
      contains: "export default function TaxAnalytics"
    - path: "web/src/components/AIInsight.tsx"
      provides: "AI insight placeholder component"
      contains: "export default function AIInsight"
  key_links:
    - from: "web/src/App.tsx"
      to: "web/src/pages/Analytics.tsx"
      via: "Route path=/analytics"
      pattern: "Route.*path.*analytics"
    - from: "web/src/pages/Analytics.tsx"
      to: "web/src/hooks/useAnalytics.ts"
      via: "uses all analytics hooks to populate charts"
      pattern: "useOverview|useCashFlow|useTopSymbols"
    - from: "web/src/pages/Analytics.tsx"
      to: "web/src/pages/Journal.tsx"
      via: "navigate to /journal?entry_type=X for drill-down"
      pattern: "navigate.*journal.*entry_type"
---

<objective>
Create the two new analytics pages (Analytics dashboard and Tax Analytics), the AI insight placeholder, and update routing + navigation. This is the capstone plan that brings all previous work together into user-facing analytics dashboards.

Purpose: The management dashboard gives admins a comprehensive view of all accounting activity. The tax analytics page provides deep insight into capital gains and tax obligations. Both pages use the chart components, hooks, and filter components built in previous plans.

Output: Analytics.tsx page, TaxAnalytics.tsx page, AIInsight.tsx placeholder, updated App.tsx routes and Layout.tsx navigation
</objective>

<execution_context>
@C:/Users/PC/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/PC/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/12-management-dashboard-comprehensive-analytics/12-04-SUMMARY.md
@.planning/phases/12-management-dashboard-comprehensive-analytics/12-05-SUMMARY.md
@web/src/App.tsx
@web/src/components/Layout.tsx
@web/src/hooks/useAnalytics.ts
@web/src/components/charts/index.ts
@web/src/components/filters/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Analytics and TaxAnalytics pages</name>
  <files>
    web/src/pages/Analytics.tsx
    web/src/pages/TaxAnalytics.tsx
  </files>
  <action>
**Analytics.tsx** — Full management dashboard page at `/analytics`.

Layout structure:
```
FilterBar (DateRangePicker, WalletSelector, ChainSelector, GranularitySelector)
─────────
KPI Cards Row (4 cards: Total Inflow, Total Outflow, Net Flow, Unique Tokens)
─────────
2-column grid:
  Left: CashFlowChart (full width top)
  Right: CompositionDonut
─────────
2-column grid:
  Left: IncomeExpenseChart
  Right: EntryTypeBar
─────────
Full width: Top Symbols table (DataTable with columns: symbol, volume_usd, inflow, outflow, tx_count)
─────────
2-column grid:
  Left: Top Protocols table (DataTable)
  Right: Flow by Wallet table (DataTable)
─────────
Full width: ActivityHeatmap
```

State management:
- Use `useState` for filter state (dateFrom, dateTo, walletId, chain, granularity)
- Pass filters to all `useAnalytics` hooks
- Use `useOverview` for KPI data
- Use individual hooks for each chart section

Drill-down navigation:
- CashFlowChart: on bar click, navigate to `/journal?date_from=X&date_to=Y` for that period
- EntryTypeBar: on bar click, navigate to `/journal?entry_type=X`
- Top Symbols table: on row click, navigate to `/journal?symbol=X`
- Use `useNavigate` from react-router-dom

Loading states: Show skeleton/spinner per section while data loads. Use TanStack Query's `isLoading` state.

Error states: Show "Failed to load" message per section with retry button.

**TaxAnalytics.tsx** — Tax analytics dashboard page at `/tax/analytics`.

Layout structure:
```
FilterBar (DateRangePicker, SymbolInput, GranularitySelector)
─────────
KPI Cards Row (4 cards: Total Gains, Total Losses, Net Gain, Tax Due)
─────────
Full width: GainsLossChart (realized gains over time)
─────────
2-column grid:
  Left: Gains by Symbol table (DataTable: symbol, gain, loss, net, avg_holding, count)
  Right: HoldingDistribution chart
─────────
Full width: WinnersLosers component (top 10 each)
─────────
2-column grid:
  Left: TaxBreakdown (by period — show taxable count, exempt count, tax_due)
  Right: TaxByCategory (by exemption reason)
─────────
Full width: Unrealized P&L table (DataTable: symbol, qty, cost_basis, cost_per_unit)
─────────
Full width: Cost Basis Summary table (DataTable: symbol, total_cost, avg_cost, total_qty)
```

KPI cards compute:
- Total Gains: sum all positive gain_usd from gains-by-symbol
- Total Losses: sum all negative
- Net: total gains + total losses
- Tax Due: sum tax_amount_vnd from tax breakdown

Same loading/error/drill-down patterns as Analytics page.

Link at top: "Back to Tax" button → navigate to `/tax`.
  </action>
  <verify>
Run: `cd web && npx tsc --noEmit` — no TypeScript errors.
Verify both pages import charts, hooks, and filters.
  </verify>
  <done>Analytics page shows comprehensive management dashboard with 8+ chart/table sections and drill-down navigation. TaxAnalytics page shows 8+ tax-specific chart/table sections.</done>
</task>

<task type="auto">
  <name>Task 2: Create AIInsight placeholder and update routes + navigation</name>
  <files>
    web/src/components/AIInsight.tsx
    web/src/App.tsx
    web/src/components/Layout.tsx
  </files>
  <action>
**AIInsight.tsx** — Placeholder component for future AI-powered insights.

```tsx
interface AIInsightProps {
  context?: string  // e.g. "analytics", "tax", "journal"
  data?: unknown    // data to analyze
}
```

Render a subtle card with:
- Sparkle/brain icon (use lucide-react `Sparkles` or `Brain`)
- "AI Insights" title
- "Coming soon — AI-powered analysis of your portfolio and tax data." message
- Grayed out "Generate Insight" button (disabled)
- Style: `bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-xl p-4 opacity-75`

**App.tsx** — Add routes:
```tsx
<Route path="/analytics" element={<Analytics />} />
<Route path="/tax/analytics" element={<TaxAnalytics />} />
```

Import both pages.

**Layout.tsx** — Add navigation items in the `navItems` array:

Insert after "Errors" and before "Tax":
```tsx
{ to: '/analytics', icon: BarChart3, label: 'Analytics' },
```

Insert after "Tax":
```tsx
{ to: '/tax/analytics', icon: TrendingUp, label: 'Tax Analytics' },
```

Import `BarChart3` and `TrendingUp` from lucide-react.

The nav order should be: Dashboard, Entities, Imports, Wallets, Transactions, Parser Debug, Journal, Accounts, Errors, **Analytics**, Tax, **Tax Analytics**, Reports.
  </action>
  <verify>
Run: `cd web && npx tsc --noEmit` — no TypeScript errors.
Verify routes exist for /analytics and /tax/analytics.
Verify Layout shows Analytics and Tax Analytics in sidebar nav.
  </verify>
  <done>AIInsight placeholder exists, /analytics and /tax/analytics routes are registered, sidebar navigation includes both new pages in logical order.</done>
</task>

</tasks>

<verification>
- `cd web && npx tsc --noEmit` — zero TypeScript errors
- `cd web && npm run build` — builds successfully
- Routes /analytics and /tax/analytics are registered in App.tsx
- Layout sidebar shows 13 nav items including Analytics and Tax Analytics
- AIInsight component renders without errors
</verification>

<success_criteria>
- Analytics page renders management dashboard with KPI cards, charts, tables, and drill-down
- TaxAnalytics page renders tax-focused dashboard with gains, holdings, tax breakdown
- Both pages handle loading and empty states gracefully
- Sidebar navigation includes both new pages
- AIInsight placeholder is ready for future implementation
- Full frontend build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/12-management-dashboard-comprehensive-analytics/12-06-SUMMARY.md`
</output>
